<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <link type="text/css" rel="stylesheet" href="css/web2cal.css">
    <link type="text/css" rel="stylesheet" href="css/web2cal-responsive.css">
    <link type="text/css" rel="stylesheet" href="js/optional/css/timecontrol.css">

    <script src="js/web2cal.support.js">  </script>
    <script src="js/web2cal.templates.js">  </script>

    <script src="js/web2cal.dummydata.js">  </script>
    <script src="js/optional/timecontrol.js">  </script>
    <style>
        .formRow{clear:both;}
        .web2cal-form input[type="text"]{width:100%}
    </style>
    <title>Web2Cal | Custom Templates Demo</title>
</head>

<body>
<div class="sample-desc" >
    Example shows you how to create custom forms and customize the preview. 
    <p>You can collect any kind of information when creating an event. The example below collects a Patient information</p>
</div>
<div id="calendarContainer">
</div>
<!-- Preview Template... -->
<div id="customPTemplate"  class="absPosition calComponent calendarTemplate" style="position:absolute;display:none">
    <a class="close" href="javascript:void(0)" onclick="Web2Cal.hidePreview()">x</a>
    <div style="padding:3px; background:#FFFFF3;">
        <div class="aPointer p-left" style="display: block; z-index: 2; "></div>
        <div class="header">
            ${eventName}
        </div>
        <div class="prevRow">
            <label>From: </label>
            <div class="controls">${_formattedStartDate} ${formattedStartTime}</div>
        </div>
        <div class="prevRow">
            <label>To: </label>
            <div class="controls">${_formattedEndDate} ${formattedEndTime}</div>
        </div>
        <div class="prevRow">
            <label>Description: </label>
            <div class="controls">${description}</div>
        </div>

        <div class="prevRow">
            <label>Movable: </label>
            <div class="controls">${movable}</div>
        </div>

        <div class="prevRow">
            <label>Resizable: </label>
            <div class="controls">${resizable}</div>
        </div>

        <div class="prevRow">
            <label>Patient Name: </label>
            <div class="controls">${attribute1}</div>
        </div>

        <div class="prevRow">
            <label>Insurance #: </label>
            <div class="controls">${attribute2}</div>
        </div>

        <div class="prevRow">
            <label>Address #1: </label>
            <div class="controls">${attribute3}</div>
        </div>
        <div class="prevRow">
            <label>Address #2: </label>
            <div class="controls">${attribute3}</div>
        </div>

        <div class="prevRow">
            <label>City: </label>
            <div class="controls">${attribute4}</div>
        </div>

        <div class="prevRow">
            <label>State: </label>
            <div class="controls">${attribute5}</div>
        </div> 
        <div class="actions">
            <a href="#" onclick="editMyEvent('${eventId}');" name="edit" class="btn buttonSmall"> Edit event </a>
            <a href="#" onclick="deleteMyEvent('${eventId}');" name="delete" class="btn  buttonSmall"> Delete event </a>
        </div>
    </div>
</div>



<!-- New Form -->
<div id="customNewEventTemplate" class="absPosition calComponent calendarTemplate web2cal-form  borderAndShadow boldlabelform">
    <div class="aPointer p-left " ></div>
    <div class="header" >
        Create New Event
    </div>
    <div class="formRow">
        <label>Name: </label>
        <div class="controls"><input placeholder="Event Name" type="text" name="eventName" style="" id="eventName"></div>
    </div>
    <div class="formRow">
        <label>Time: </label>
        <div class="value">
            <input type="Text" name="eventStartDate" style="width:150px;" id="eventStartDate"/>
            <input type="Text" name="eventStartTime" style="width:100px;" id="eventStartTime"/>
            <input type="Text" name="eventEndDate" style="width:150px;" id="eventEndDate"/>
            <input type="Text" name="eventEndTime" style="width:100px;" id="eventEndTime"/>
        </div>
    </div>
    <div class="formRow">
        <div class="fleft" style="margin-right:65px;">
            <label>All Day?</label>
            <div class="controls"><input type="checkbox" class="inputbox" id="allDayEvent"/></div>
        </div>
        <div class="fleft">
            <label>Group: </label>
            <div class="controls"><select name="eventGroup" style=" border:1px solid #C3D9FF;"  id="eventGroup"></select></div>
        </div>
    </div>
    <div class="formRow" >
        <label style="float:left;">  <input type="checkbox" value="Y" id="chkMovable"/> Movable?</label>

        <label style="float:right;"> <input type="checkbox" value="N" id="chkResizable"/> Resizable?</label>
    </div>
    <div class="clearfix"></div>
    <div class="formRow">
        <label>Patient Name: </label>
        <div class="controls" style="float:left;width:49%;"><input placeholder="First Name" type="text" style=" width:100%;; " id="attribute1"></div>
        <div class="controls" style="float:left;width:49%;"><input placeholder="Last Name"  type="text" style=" width:100%;;" id="attribute1"></div>
    </div>
    <div class="formRow">
        <label>Insurance #: </label>
        <div class="controls"><input type="text" placeholder="Insurance #" style="" id="attribute2"></div>
    </div>
    <div class="formRow">
        <label>Address #1: </label>
        <div class="controls"><input type="text" style="" placeholder="Address Line 1" id="attribute3"></div>
    </div>
    <div class="formRow">
        <label>Address #2: </label>
        <div class="controls"><input type="text" style="" placeholder="Address Line 2"  id="attribute4"></div>
    </div>
    <div class="formRow">
        <label>City: </label>
        <div class="controls"><input type="text" style="" placeholder="City" id="attribute5"></div>
    </div>
    <div class="formRow">
        <label>State: </label>
        <div class="controls"><input type="text" style="" placeholder="State" id="attribute6"></div>
    </div>
    <div class="formRow">
        <label>Notes: </label>
        <div class="controls"><textarea style="width:100%;"  placeholder="Description / Notes for the appointment" id="eventDescription"></textarea></div>
    </div>
    <div class="actions">
        <a href="javascript:void(0)" onclick="addMyEvent();" id="newEvAddEventBtn"  class="btn buttonSmall">Save</a>
        <a href="javascript:void(0)" onclick="updateMyEvent();" id="newEvUpdateEventBtn" style="display :none;" class="btn buttonSmall">Update</a>
        <a href="javascript:void(0)" onclick="Web2Cal.closeAddEvent();"  class="btn buttonSmall">Close</a>
    </div>
</div>

</body>
</html>
<script>
var WEB2CAL_LICENSE_KEY=["*****EMBED YOUR LICENSE KEY HERE****" ];
var ical,activeEvent
        , newEventForm="customNewEventTemplate"
        , mobileNewEventForm="newEventFormMobile"
        , preview="customPTemplate"
        , mobilePreview="eventPreviewMobile"
        ;

/*
 Create the Calendar.
 */
function drawCalendar()
{
    ical = new Web2Cal('calendarContainer', {
        loadEvents:             loadCalendarEvents,
        detectMobileMode:       true,
        monthWithEvents:        true,
        defaultView:            "month",
        detectMobileMode:       true,
        newEventTemplateMobile: mobileNewEventForm,
        newEventTemplate:       newEventForm,
        previewTemplate:        preview,
        previewTemplateMobile:  mobilePreview,
        onNewEvent:             onNewEvent,
        onPreview:              onPreview
    });
    ical.build();
}
function onPreview(evt, dataObj, html)
{
    activeEvent=dataObj;
    ical.showPreview(dataObj, html);
    if(dataObj.readOnly) {
        jQuery("#fullPreview .actions").hide();
    } else {
        jQuery("#fullPreview .actions").show();
    }
}

/*
 Method invoked when event is moved or resized
 @param event object containing eventID and newly updated Times
 */
function updateEvent(event)
{
    ical.updateEvent(event);
}

/*
 Method invoked when creating a new event, before showing the new event form.
 @param obj - Object containing (startTime, endTime)
 @param groups - List of Group objects ({groupId, name})
 @param allday - boolean to indicate if the event created is allday event.
 */
function onNewEvent(obj, groups, allday)
{
    var newevt=jQuery("#customNewEventTemplate");
    //Clear out and reset form
    newevt.find("#eventDesc").val("").end()
            .find("#eventName").val("").focus().end()
            .find("#eventStartDate").val( obj.startTime.toString("MM/dd/yyyy")).end()
            .find("#eventEndDate").val(obj.endTime.toString("MM/dd/yyyy")).end();

    if(allday)
        newevt.find("#allDayEvent").attr("checked", true).end()
                .find("#eventStartTime").val("").end()
                .find("#eventEndTime").val("");
    else
        newevt.find("#allDayEvent").attr("checked", false).end()
                .find("#eventStartTime").val( obj.startTime.toString("hh:mm tt") ).end()
                .find("#eventEndTime").val( obj.endTime.toString("hh:mm tt") );

    //display a list of groups to select from.
    var groupDD=newevt.find("#eventGroup").get(0);
    removeAllOptions(groupDD);
    for(var g in groups)
    {
        if(!groups.hasOwnProperty(g))continue;
        var gId = groups[g].groupId;
        addOption(groupDD, groups[g].groupName,groups[g].groupId,false);
    }
    if(obj.group && obj.group.groupId)
        newevt.find("#eventGroup").val(obj.group.groupId);

    newevt.find("#newEvAddEventBtn").show().end()
            .find("#newEvUpdateEventBtn").hide();
}

/**
 Method to get Events and display it in the calendar.
 If you need to make an asynchronous call, invoke ical.render in the callback method.
 @param startTime - Calendar Display Range start
 @para endTime - Calendar End Range end
 */
function loadCalendarEvents(startTime, endTime)
{
    ical.render(Web2Cal.sampleData());
}

/**
 * Click of Add in add event box.
 */
function addMyEvent()
{
    newev = getEventFromForm()
    ical.addEvent(newev);
    return false;
}

function getEventFromForm()
{
    var newEventContainer = jQuery("#customNewEventTemplate");
    var name=newEventContainer.find( "#eventName").val();
    var grp=newEventContainer.find("#eventGroup").val();
    var grpName=newEventContainer.find("#eventGroup  option:selected").text();
    var strtTime=newEventContainer.find("#eventStartTime").val();
    var endTime=newEventContainer.find("#eventEndTime").val();
    var startDate=newEventContainer.find("#eventStartDate").val();
    var endDate=newEventContainer.find("#eventEndDate").val();
    var description=newEventContainer.find("#eventDescription").val();
    var movable=newEventContainer.find("#chkMovable").val();
    var resizable=newEventContainer.find("#chkResizable").val();

    var attr1=newEventContainer.find("#attribute1").val();
    var attr2=newEventContainer.find("#attribute2").val();
    var attr3=newEventContainer.find("#attribute3").val();
    var attr4=newEventContainer.find("#attribute4").val();
    var attr5=newEventContainer.find("#attribute5").val();
    var attr6=newEventContainer.find("#attribute6").val();

    if(name=="")
    {
        name="No Title";
    }

    var alldaybox=jQuery("#allDayEvent", newEventContainer).get(0);
    var allday=alldaybox.checked;
    var start	=	getDateFromStrings(startDate, strtTime);
    var end		=	getDateFromStrings(endDate, endTime);
    if(allday)
    {
        start.setHours(0,0,0);
        end.setHours(0,0,0);
    }
    var newev={name:name,  startTime:start, endTime:end
        , allDay:allday
        , group:{groupId:grp, name: grpName}
        , eventId: Math.ceil(999*Math.random())
        , description: description
        , resizable: resizable
        , movable: movable
        , attribute1: attr1
        , attribute2: attr2
        , attribute3: attr3
        , attribute4: attr4
        , attribute5: attr5
        , attribute6: attr6
    };
    return newev;
}

function updateMyEvent()
{
    newev = getEventFromForm();
    newev.eventId=editingEvent.eventId;
    jQuery("#customNewEventTemplate").hide()
    ical.updateEvent(newev);
}

//Show Edit Form
var editingEvent;
function editMyEvent(eventId)
{ 
      var eventObject = ical.getEventById(eventId);
    editingEvent=eventObject;
    var newEventContainer = jQuery("#customNewEventTemplate");
    var name=newEventContainer.find( "#eventName").val(eventObject.eventName);
    var grp=newEventContainer.find("#eventGroup").val(eventObject.group.groupId);

    var strtTime=newEventContainer.find("#eventStartTime").val(  eventObject.startTime.formattedStartTime );
    var endTime=newEventContainer.find("#eventEndTime").val(eventObject.endTime.formattedStartTime );
    var startDate=newEventContainer.find("#eventStartDate").val( eventObject.startTime.toString("MM/dd/yyyy") );
    var endDate=newEventContainer.find("#eventEndDate").val(  eventObject.startTime.toString("MM/dd/yyyy") );
    var description=newEventContainer.find("#eventDescription").val(eventObject.description);
    var attr1=newEventContainer.find("#attribute1").val(eventObject.attribute1);
    var attr2=newEventContainer.find("#attribute2").val(eventObject.attribute2);
    var attr3=newEventContainer.find("#attribute3").val(eventObject.attribute3);
    var attr4=newEventContainer.find("#attribute4").val(eventObject.attribute4);
    var attr5=newEventContainer.find("#attribute5").val(eventObject.attribute5);
    var attr6=newEventContainer.find("#attribute6").val(eventObject.attribute6);
    newEventContainer.find("#newEvAddEventBtn").hide().end()
            .find("#newEvUpdateEventBtn").show();
    Web2Cal.hidePreview();

    ical.showEditEventTemplate(newEventContainer, eventObject.eventId, eventObject);

    return false;
}
//Delete Event
function deleteMyEvent(eventId)
{
    var ev= {eventId:eventId}
    ical.deleteEvent(ev);
}

/**
 * Onclick of Close in AddEvent Box.
 */
function closeAddEvent()
{
    Web2Cal.closeAddEvent();
}

WEB2CAL_LICENSE_KEY=["*****EMBED YOUR LICENSE KEY HERE****" ];
/**
 * Once page is loaded, invoke the Load Calendar Script.
 */
jQuery(document).ready(function()
{
    drawCalendar();

    new Web2Cal.TimeControl(jQuery("#eventStartTime").get(0));
    new Web2Cal.TimeControl(jQuery("#eventEndTime").get(0), jQuery("#eventStartTime").get(0), {
        onTimeSelect: updateDateForTime,
        dateField: "eventEndDate"
    });
});
</script>
